# Taper — Trackable Tracker Roadmap

## What We're Building

A trackable tracker app. You add trackables (like caffeine, alcohol), log doses (e.g., 90mg coffee, 330ml beer), and see a **pharmacokinetic decay curve** showing how much is still active in your system throughout the day.

## Architecture

**Flutter + Riverpod + Drift** — a reactive architecture where the database emits streams, providers transform them, and widgets rebuild automatically.

| Layer | Flutter | Laravel equivalent |
|-------|---------|-------------------|
| UI (Widgets) | `StatelessWidget` / `ConsumerWidget` | Blade templates / Vue components |
| State Management | Riverpod `StreamProvider` / `FutureProvider` | Controller (reactive, like Inertia props) |
| Database | Drift tables + query methods on `AppDatabase` | Eloquent models + query scopes |
| Models | Drift-generated `DataClass` (e.g., `Trackable`) | Eloquent Model attributes |
| DI | Riverpod `Provider` (auto-scoped) | `AppServiceProvider` bindings |

No separate repository or DAO layer — Drift query methods live directly on `AppDatabase`, and Riverpod providers wrap them. Simpler than the old Kotlin MVVM setup.

## Project Structure

```
lib/
├── main.dart                              # App entry point, ProviderScope, MaterialApp
├── data/
│   ├── database.dart                      # Drift tables, AppDatabase, all query methods
│   ├── database.g.dart                    # Generated by build_runner (never edit manually)
│   └── decay_model.dart                   # DecayModel enum (none/exponential/linear)
├── providers/
│   └── database_providers.dart            # Riverpod providers wrapping database streams
├── utils/
│   ├── day_boundary.dart                  # 5 AM day boundary utilities
│   └── decay_calculator.dart              # Pharmacokinetic decay math (exponential + linear)
├── services/
│   └── notification_service.dart          # Persistent notification for rapid dose tracking
└── screens/
    ├── home_screen.dart                   # Bottom nav scaffold (Dashboard / Log / Trackables)
    ├── dashboard_screen.dart              # Dashboard tab (trackable cards + decay curves)
    ├── dashboard/
    │   ├── trackable_log_screen.dart      # Per-trackable dose history (infinite scroll)
    │   └── widgets/
    │       ├── trackable_card.dart        # Card: stats + chart + toolbar
    │       └── decay_curve_chart.dart     # Mini fl_chart LineChart
    ├── log/
    │   ├── log_dose_screen.dart           # Recent doses list + FAB to add
    │   ├── add_dose_screen.dart           # Full form: trackable picker, amount, time
    │   ├── edit_dose_screen.dart          # Edit existing dose log
    │   └── widgets/
    │       └── time_picker.dart           # Reusable time picker widget
    ├── shared/
    │   └── quick_add_dose_dialog.dart     # Quick-add dialog (from dashboard cards)
    └── trackables/
        ├── trackables_screen.dart         # Trackable list with reorder, pin
        ├── add_trackable_screen.dart      # Full form: name, unit, decay model, params
        └── edit_trackable_screen.dart     # Edit form + visibility toggle + delete
```

## Dependencies

| Package | Purpose |
|---------|---------|
| flutter_riverpod | State management (like a reactive service container) |
| drift + drift_flutter | Type-safe SQLite ORM (like Eloquent, with code generation) |
| fl_chart | Charting library for decay curves |
| path_provider + path | Locating the SQLite database file on disk |
| flutter_local_notifications | Persistent notification for rapid dose tracking |

Dev: `drift_dev` + `build_runner` for code generation.

## Data Models (schema v6)

### Trackable
| Column | Type | Notes |
|--------|------|-------|
| `id` | `int` | Auto-increment PK |
| `name` | `String` | e.g., "Caffeine", "Alcohol" |
| `halfLifeHours` | `double?` | Nullable. For exponential decay (e.g., 5.0 for caffeine) |
| `unit` | `String` | e.g., "mg", "ml", "g", "IU" — displayed in all amount fields |
| `isMain` | `bool` | Legacy, no longer used (kept for migration compat) |
| `isVisible` | `bool` | Default `true`. Hidden trackables don't appear in dropdowns/dashboard |
| `color` | `int` | ARGB color value. Auto-assigned from palette, cycles through 10 colors |
| `sortOrder` | `int` | For drag-to-reorder in the trackables list |
| `decayModel` | `String` | `'none'`, `'exponential'`, or `'linear'` |
| `eliminationRate` | `double?` | Nullable. Units-per-hour for linear decay (e.g., 9.0 ml/h for alcohol) |

### DoseLog
| Column | Type | Notes |
|--------|------|-------|
| `id` | `int` | Auto-increment PK |
| `trackableId` | `int` | FK → trackables (cascade delete) |
| `amount` | `double` | Raw amount in the trackable's unit |
| `loggedAt` | `DateTime` | When the dose was consumed |

## Decay Models

### Exponential (half-life)
```
active_amount(t) = Σ dose × 0.5^(hours_elapsed / half_life)
```
Used for trackables like caffeine. Cutoff at 5 half-lives (~3% remaining). Sampling every 5 minutes for graphing.

### Linear (constant-rate elimination)
```
active_amount(t) = max(0, dose - elimination_rate × hours_elapsed)
```
Used for trackables like alcohol where the liver processes at a constant rate (zero-order kinetics). BAC drops linearly at ~0.015%/hr. Query window: 24 hours.

### None
No decay tracking. Used for trackables like water where you just want to track intake totals.

## Day Boundary

**"Today" starts at 5:00 AM**, not midnight. This lets late-night doses (e.g., alcohol at 1am) count as the previous day. Implemented as a **shared utility function** used everywhere: dashboard stats, mini graphs, trackable log day grouping, notification stats.

The 5am default becomes a user setting in a later milestone.

## Deletion UX

No swipe-to-delete anywhere. All delete actions use a **delete button with a confirmation dialog** ("Are you sure you want to delete this dose?"). Applies to dose logs and trackables alike.

---

## Implementation Milestones

### Milestone 1: Trackable CRUD ✅
- Drift tables + dependencies
- Trackable table + AppDatabase + seeder (inserts "Caffeine" on first run)
- Riverpod providers for trackable streams
- Bottom nav scaffold (Dashboard / Log / Trackables tabs)
- Trackables screen with full CRUD (add, edit, delete with confirmation)

### Milestone 2: Dose Logging ✅
- DoseLog table + query methods
- Log dose screen with recent doses list + FAB to add
- Dedicated AddDoseScreen with trackable picker, amount input, time picker
- Trackable dropdown auto-selects last-used trackable (falls back to first visible)
- Each entry shows: trackable name, amount with unit, time logged
- Delete button on each entry
- Tapping an entry opens EditDoseScreen for editing

### Milestone 3: Per-Trackable Fields ✅
- **Unit field:** `unit` column (e.g., "mg", "ml"). All UI displays the trackable's unit.
- **Half-life field:** `halfLifeHours` column. Editable in the trackable form.
- **Color field:** `color` column (ARGB int). Auto-assigned from a 10-color palette, cycles.
- **Rename `amountMg` → `amount`:** Migration renames the column.
- Updated seeder: Caffeine (mg, 5h, exponential), Water (ml, none), Alcohol (ml, hidden).

### Milestone 4: Dashboard — Trackable Cards & Decay ✅
- **Day boundary utility** — 5 AM boundary, shared everywhere.
- **DecayCalculator** — Pure static methods for exponential decay, unit tested.
- **Trackable cards** — One per visible trackable. Stats line (active/total), mini decay curve, toolbar (repeat last, add dose, view log).
- **Trackable log screen** — Full history for a single trackable, lazy-loads 3 days at a time, grouped by day with daily totals.
- **Staggered loading** — Each card has its own provider, resolves independently.
- **Quick-add dialog** — From dashboard cards for rapid dose logging.

### Milestone 5: Trackable Edit Revamp + Linear Decay ✅
- **DecayModel enum** (`none`/`exponential`/`linear`) with DB serialization.
- **Database schema v6** — Added `decayModel` and `eliminationRate` columns. Migration backfills existing data (caffeine→exponential, alcohol→linear at 9 ml/hr).
- **Linear decay math** — `activeLinearDoseAt()`, `totalActiveLinearAt()`, `generateLinearCurve()` in DecayCalculator.
- **3-way decay switching** — Providers, notification service, and UI all branch on DecayModel.
- **EditTrackableScreen revamp** — Decay model dropdown, conditional half-life/elimination-rate fields, visibility SwitchListTile, delete with confirmation dialog.
- **AddTrackableScreen** — Dedicated full screen (replaced bottom sheet) with all fields.
- **AddDoseScreen** — Dedicated full screen (replaced bottom sheet) with trackable picker, amount, time.
- **Simplified trackables list** — Removed star/eye/delete icons (moved to edit screen). Kept color dot, reorder arrows, pin. Subtitle shows decay model info.
- **Log form auto-select** — Uses last-logged trackable instead of `isMain`.
- **Persistent notification updated** — 3-way decay switch in `_update()`.

### Milestone 6: Persistent Tracking Notification ✅
- Sticky notification for "party mode" — pin a trackable from the trackables list.
- Shows trackable name, active amount, total today, last logged time.
- "Repeat last" and "Add dose" action buttons.
- Updates in real-time as decay values change.
- Only one trackable pinned at a time.

### Milestone 7: Polish ✅
- [x] Swipe-to-delete on dose log entries (with undo snackbar)
- [x] Swipe-to-delete on trackable log screen entries
- [x] Date picker on dashboard to view historical days
- [x] Color picker in trackable edit screen

### Milestone 8: UX & Settings ← NEXT
- [ ] **Dismiss action on snackbars** — all snackbars should have a dismiss/close button
- [ ] **Larger decay graph** — make charts taller, maybe even taller than wide, so the curve is easier to read
- [ ] **Copy dose** — add a copy button to dose log entries that opens the add dose screen pre-filled with that dose's trackable, amount, and current time. Quick way to repeat a past dose.
- [ ] **Copy trackable** — add a copy/duplicate button to trackables that creates a new trackable pre-filled with the original's settings (unit, decay model, half-life, etc.) but with a "Copy of X" name
- [ ] **Unify list design** — use the log overview design (the nicer one) as the template for all lists. For the trackables list specifically: keep reorder handles, keep pin, but make tap/press open the edit screen directly (instead of navigating elsewhere)
- [ ] **Merge trackables into settings tab** — remove the standalone Trackables tab. The Settings tab now shows the trackable list first (with reorder, pin, tap-to-edit), followed by a "Settings" header with the rest of the settings below it. Fewer tabs, cleaner navigation.
- [ ] **Day boundary setting** — let users configure the hour that defines "start of day" (default 5:00 AM). Stored as a user preference.
- [ ] **Dark mode toggle** — light / dark / auto (system default) theme toggle in settings. Currently dark-only.
- [ ] **Absorption speed field** — optional `absorptionMinutes` on trackables. Models time to peak effect (e.g., caffeine ~45 min). Decay curve ramps up over this period before decaying.
- [ ] **Thresholds per trackable** — multiple named thresholds (e.g., "Healthy daily limit" = 400mg caffeine, "Sleep cutoff" = 200mg). Each has a `name`, `amount`, and optional `rollingAverageDays` for rolling average comparison. Show as horizontal lines on the decay chart and indicators on dashboard card stats.
- [ ] **Performance: zero background work** — the app should do nothing when not visible. See details below.

#### Performance: Zero Background Work

The app is a simple local tracker — it should be completely idle when the user isn't looking at it. Currently it's not.

**Problem 1: Stale dashboard on app resume**
`trackableCardDataProvider` captures `DateTime.now()` once when its stream is created. Decay amounts and the "now" dotted line freeze at that time. Reopening the app hours later shows stale data because Drift streams only re-emit on data changes, not time changes.

*Fix:* Add an `appLifecycleRefreshProvider` — a `Notifier` with `WidgetsBindingObserver` that:
1. On `resumed`: increments a counter (triggers immediate refresh) **and** starts a 5-minute `Timer.periodic` that keeps incrementing while the app stays in the foreground.
2. On `paused`: cancels the timer (zero background work).

The card data provider watches this counter, so any increment triggers a fresh `DateTime.now()` recalculation. This gives us: instant refresh on app open + fresh data every 5 min while staring at the dashboard + zero work in background.

**Problem 2: Notification timer runs in background (15s)**
`NotificationService._updateTimer` is a `Timer.periodic(15 seconds)` that recalculates decay and updates the notification. It keeps running even when the app is backgrounded (until the OS kills it). 15 seconds is aggressive.

The timer can't be removed entirely — it also re-posts the notification because Android lets users swipe away "ongoing" notifications. Without the timer, a dismissed sticky notification would never come back.

*Fix:* Increase the interval (30–60s). The notification shows rounded values so a 1-minute lag is imperceptible, and re-posting within 60s of a swipe-dismiss is fast enough. No need to pause on background — the timer naturally stops when the OS suspends the app, and the notification needs to stay visible anyway.

**Problem 3: IndexedStack keeps all tabs alive**
`HomeScreen` uses `IndexedStack` which keeps all 3 tabs (Dashboard, Log, Settings) mounted simultaneously. Every Drift `.watch()` stream across all tabs stays subscribed even when the tab is invisible. That's ~8+ active SQLite watchers at all times.

*Fix:* This is a tradeoff. IndexedStack preserves scroll position and form state when switching tabs (good UX). The alternative (`PageView` or rebuilding tabs) loses that state. The Drift streams are event-driven (not polling), so they only fire on actual data changes — the cost is low in practice. **Keep IndexedStack for now**, but revisit if profiling shows it's a real drain.

**Problem 4: No app-wide background pause**
Nothing in the app reacts to lifecycle changes. Drift streams, timers, and providers all keep running when backgrounded.

*Fix:* The lifecycle observer from Problem 1 solves the resume side. For the pause side, the notification timer fix (Problem 2) handles the only active timer. Drift streams are passive (SQLite triggers, not polling), so they're cheap when no data changes — no need to tear them down.

### Milestone 9: Taper Plans

The app's namesake feature. Attach a **taper plan** to a trackable to gradually reduce intake over time — e.g., cut caffeine from 400mg/day down to 100mg/day over 6 weeks.

#### Data Model — TaperPlan
| Column | Type | Notes |
|--------|------|-------|
| `id` | `int` | Auto-increment PK |
| `trackableId` | `int` | FK → trackables. One active plan per trackable at a time. |
| `startAmount` | `double` | Daily target at the beginning (e.g., 400mg) |
| `targetAmount` | `double` | Daily target at the end (e.g., 100mg) |
| `startDate` | `DateTime` | When the taper begins |
| `endDate` | `DateTime` | When the taper should reach the target |
| `isActive` | `bool` | Only one plan per trackable can be active |

#### Linear Taper Calculation
```
daily_target(date) = startAmount + (targetAmount - startAmount) × (days_elapsed / total_days)
```
Simple linear interpolation. On day 0 the target is `startAmount`, on the final day it's `targetAmount`. Before `startDate`, no target applies. After `endDate`, the target stays at `targetAmount`.

#### Dashboard Card Integration
When a trackable has an active taper plan, the dashboard card reflects it:
- **Target line on the mini graph** — A horizontal (or gently sloping) line showing today's allowed amount. The actual consumption curve sits below or above it, making it immediately obvious if you're on track.
- **Stats line update** — e.g., "42mg active / 180mg of 350mg today" — showing consumed vs. the day's target.
- **Over-target indicator** — Visual cue (color change, warning icon) when today's total exceeds the target. Not a hard block — you can still log, but the card makes it clear you've gone over.

#### Taper Plan Management
- **Create/edit** from the trackable log screen or trackable settings — pick start/end dates and amounts.
- **Only one active plan per trackable** — starting a new plan deactivates the previous one (with confirmation). Old plans are kept for history.
- **Delete** with confirmation dialog.

#### Progress Chart
A dedicated screen (accessible from the trackable card or log screen) showing the taper's progress over its full duration:
- **X-axis:** Date range from `startDate` to `endDate`
- **Target line:** The linear taper — a straight diagonal from `startAmount` down to `targetAmount`
- **Actual consumption:** Daily totals plotted as bars or points, one per day
- **Today marker:** Vertical line or highlight showing where you are in the plan
- Clear visual of days you were on/under/over target. Good days vs. bad days at a glance.

### Milestone 10: Customizable Dashboard

The dashboard currently auto-generates one card per visible trackable. This milestone makes the dashboard fully user-configurable — choose which widgets appear, what order they're in, and what type of information each one shows.

#### Why
Right now, dashboard content is tied to the trackable's `isVisible` flag — which also controls log form dropdown visibility. That's two unrelated concerns jammed into one toggle. And there's no way to add different views of the same trackable (e.g., today's decay curve AND a weekly progress chart), or to have widgets that span multiple trackables.

The customizable dashboard decouples "what's on the dashboard" from "what trackables exist." A trackable is a data source; a dashboard widget is a view of that data.

#### Data Model — DashboardWidget

| Column | Type | Notes |
|--------|------|-------|
| `id` | `int` | Auto-increment PK |
| `type` | `String` | Widget type: `'decay_card'`, `'taper_progress'`, `'daily_totals'`, `'weekly_chart'` |
| `trackableId` | `int?` | FK → trackables. Nullable for aggregate/multi-trackable widgets. |
| `sortOrder` | `int` | Position on the dashboard (drag-to-reorder) |
| `config` | `String` | JSON blob for type-specific settings |

The `config` JSON holds per-widget options. Examples:
- Decay card: `{"showCumulativeLine": true, "chartHeight": 200}`
- Weekly chart: `{"daysBack": 7, "showAverage": true}`
- Taper progress: `{"showDailyBars": true}`

#### Widget Types

**Decay Card** (what exists today) — real-time decay curve for a single trackable. Shows active amount, total today, mini chart, toolbar (repeat last, add dose, view log). Config: chart height, cumulative line toggle.

**Taper Progress** — the taper plan progress chart (currently a separate screen reached via the card's "Progress" button). Shows the full taper timeline with target line, daily totals, and today marker. Pulling this onto the dashboard makes it visible at a glance instead of buried behind a tap.

**Daily Totals** — bar chart of daily intake totals over the past N days for a single trackable. Good for spotting trends. Config: number of days, show average line.

**Weekly Summary** — aggregate view across a trackable. Average daily intake, highest/lowest day, trend direction. Compact text widget, no chart.

More types can be added later without schema changes (just add a new `type` string and a renderer).

#### Dashboard Edit Screen

Accessed from a button on the dashboard (e.g., a pencil icon in the header or a long-press-to-edit gesture). Shows the current widget list with:

- **Drag handles** — reorder widgets (same pattern as trackable reorder).
- **Delete button** — remove a widget from the dashboard.
- **"Add Widget" button** — opens a picker: choose a widget type, then a trackable (if the type requires one), then configure options. Like adding a block in Notion.
- **Tap to configure** — opens a settings sheet for that widget (chart height, toggles, etc.).

#### Migration from Auto-Dashboard

When the user upgrades, auto-generate `DashboardWidget` rows from existing visible trackables:
- For each trackable with `isVisible == true`, create a `decay_card` widget.
- Copy `showCumulativeLine` into the widget's config JSON.
- If the trackable has an active taper plan, optionally add a `taper_progress` widget too.

After migration:
- **Remove `isVisible`'s dashboard meaning.** The `isVisible` flag stays but only controls log form dropdown visibility (renamed in the UI to "Show in log form" — which it already says). Dashboard presence is now controlled by having a widget.
- **Remove `showCumulativeLine` from trackables table.** It lives in the widget config now.

#### Default for New Trackables

When a new trackable is created, auto-add a `decay_card` widget at the bottom of the dashboard. The user can remove it or rearrange it later. This keeps the "just works" experience for simple use cases — you don't have to manually configure the dashboard every time you add a trackable.

#### Chart Style Experiment: Pan/Zoom with Gradient Fill

Before building all the widget types, experiment with fl_chart's pan & scale features (see `line_chart_sample12.dart` in the fl_chart repo). That example shows:
- **Gradient area fill** — yellow line with a gradient from semi-transparent at the top to transparent at the bottom. Looks more polished than our current flat `color.withAlpha(40)` fill.
- **Horizontal pan & pinch-to-zoom** — the user can drag the chart left/right and zoom in/out. Could be great for zooming into a specific hour on a busy decay curve.
- **Scrub tooltip with vertical line** — dashed red line + dot at the touch point with formatted date/time and value.

Try this style on the existing decay curve chart first (just the gradient fill + scrub improvements, not necessarily pan/zoom yet). If it looks good, use it as the default chart style for all dashboard widgets. Pan/zoom could be optional per-widget in the config.

### Milestone 11: Reminders & Medication Tracking

Reminder system that works for two use cases: taper plan adherence and medication schedules.

#### Scheduled Reminders (Medication Mode)
- **Per-trackable alarm** — set a recurring time-of-day reminder for a trackable (e.g., "Take thyroid meds at 8:00 AM daily"). Uses local notifications.
- **One-time reminder** — set a single reminder for a specific date/time (e.g., "Take second dose at 2 PM today"). Auto-clears after firing.
- **Nag mode ("remind until done")** — set an interval in minutes (e.g., every 15 min). The reminder repeats until a dose is actually logged for that trackable. Useful for medications you absolutely can't forget. Stops nagging once you log it.

#### Taper Plan Integration
- When a trackable has an active taper plan, optionally attach reminders to help pace doses throughout the day (e.g., "You have 200mg budget left, consider your next dose at 2 PM").
- Could suggest dose timing based on the taper target and your usual pattern.

### Milestone 12: Data Export & Backup

Two export features for different use cases, accessible from the Settings screen.

#### SQLite Backup (full backup/restore)
- **Export:** Copy the raw `.db` file to the system share sheet (save to Files, send via AirDrop/email, upload to Drive — whatever the OS offers). The file contains everything: trackables, dose logs, taper plans, settings.
- **Import:** Pick a `.db` file, replace the current database, restart the app. All-or-nothing restore. Drift's migration system handles schema version differences (e.g., restoring an older backup into a newer app version).
- This is the "I got a new phone" or "I want a safety net" workflow.

#### CSV Export (data portability)
- Export trackables and dose logs as CSV files (one per table, or a single zip). Human-readable, openable in Excel/Google Sheets, useful for analysis or sharing with a doctor.
- **Export only** — no CSV import. Reconstructing foreign keys and validating data from CSV is a lot of code for a feature nobody will use. If you need to restore, use the SQLite backup.

### Milestone 13: Onboarding & First-Run Experience

The "make it feel like a real app" milestone. Runs on first launch (or when the user has no trackables).

#### Startup Wizard
A multi-step welcome flow that guides new users through initial setup:
1. **Welcome screen** — brief intro to what Taper does.
2. **Pick your trackables** — a grid/list of common trackables with pre-filled settings. User taps to select which ones they want. Examples:
   - Caffeine (mg, exponential, 5h half-life)
   - Alcohol (ml, linear, 9 ml/hr elimination)
   - Nicotine (mg, exponential, 2h half-life)
   - Water (ml, no decay)
   - Common medications (ibuprofen, melatonin, etc.)
   - Option to add a custom trackable right from the wizard
3. **Analytics opt-in** — ask the user if they're OK with anonymous crash reporting and usage analytics. Clear, honest language about what's collected (aggregate feature usage, crash reports) and what's not (no PII, no tracking). Respect the choice — default to off.
4. **Done** — drop into the dashboard with their selected trackables ready to go.

#### Analytics & Crash Reporting
Integrated into the onboarding opt-in but also toggleable later from Settings.
- **Crash reports** — catch and report unhandled exceptions so bugs in production are visible. Look at something like Sentry or Firebase Crashlytics.
- **Anonymous usage analytics** — track which features are used (e.g., how many people use taper plans, linear vs. exponential decay, etc.) to guide development priorities. Must be:
  - Opt-in or at minimum clearly disclosed
  - No PII, no tracking IDs tied to identity
  - Aggregate counts only, not individual behavior
- Investigate options: Firebase Analytics (heavy, Google), PostHog (self-hostable), Aptabase (privacy-first, built for mobile), or simple custom endpoint.

#### Empty State Improvements
When a user has no trackables or no doses logged yet, show helpful hints instead of blank screens — "Tap + to add your first trackable", "Log your first dose to see your decay curve", etc. These complement the wizard for users who skip it or delete all their data.

---

## Parked Ideas

Ideas that are good but not scheduled yet. Revisit when the core milestones are done.

- **Multi-trackable combined chart:** Overlay multiple trackables on one chart with different colored lines. Might be too noisy to be useful — revisit if the single-trackable cards feel limiting.
- **Home screen widget:** Glanceable current levels without opening the app. Complements the notification for a less intrusive always-visible option.
- **Non-linear taper curves:** Step-down schedules (reduce by X every N days), exponential curves, or custom schedules. Builds on the linear taper in Milestone 9.
- **Interaction warnings:** Flag when two active trackables have known interactions (e.g., caffeine + certain medications). Requires a data source for interactions.
- **Planned consumption days:** From the trackable log screen (grouped by day), copy a day's consumption pattern as a "plan" for tomorrow. E.g., you drank 5 coffees today at 8am, 10am, 12pm, 2pm, 4pm — tap "copy as plan" and those become scheduled doses for tomorrow. Then manually tweak amounts or timings to inch closer to your taper target. Ties into Milestone 9 (taper plans) — instead of just a daily total target, you get a concrete dose-by-dose schedule to follow. Think of it like duplicating a row in a spreadsheet and editing the copy.
- **Quick-add presets per trackable:** Define named shortcuts for common doses — e.g., "Office coffee" = 90mg, "Home coffee" = 120mg, "Glass of wine" = 150ml, "Pint of beer" = 500ml, "Water bottle" = 750ml. Stored as a list on the trackable. These show up as quick-tap buttons on the dashboard card and in the persistent notification, replacing the single "repeat last" with a row of your most common doses. Think of it like saved addresses in a delivery app — one tap instead of typing the same amount every time.
- **Logging reminder vibration:** When the persistent notification is active, the app checks the trackable's `reminderIntervalMinutes` field. If set (e.g., 40 for alcohol) and no dose has been logged within that interval, the phone vibrates as a nudge — "hey, did you forget to log that last drink?" The interval is a property of the trackable (like half-life or unit), so each trackable gets its own sensible default. Null means no reminders. Useful for party mode where you're likely to forget.
- **Trackable types (far future):** Right now all trackables are implicitly "decaying" (exponential/linear) or "amount" (no decay, like water). Formalize this into a `type` field with distinct dashboard visualizations:
  - **Decaying** — what caffeine/alcohol already are. Decay curve chart.
  - **Amount** — what water already is. Running total, maybe a fill-up bar chart.
  - **Count** — for things you just count (e.g., cigarettes, drinks). Dashboard shows a tally/counter visualization instead of a curve.
  - **Yes/No** — binary tracking (e.g., "Did I take my multivitamin today?"). Dashboard shows a simple check/X indicator, streak calendar, or habit-tracker grid.
  Each type gets its own card layout and chart style on the dashboard. This turns Taper from a pharmacokinetics app into a more general-purpose health tracker while keeping the decay curves as the core differentiator.
